---
title: "for"
format: html
editor: source
self-contained: true
---

Load libraries
```{r, message = FALSE, warning = FALSE, echo = F, error=FALSE}
knitr::opts_chunk$set(message = FALSE, warning = FALSE, error=FALSE)
source(here::here("R/libraries.R"))
source(here::here("R/functions.R"))
source(here::here("R/colors.R"))
```


```{r, echo = F}
#Load data
df <- readxl::read_excel(here::here('data-raw/for_data.xlsx')) %>% 
    dplyr::mutate(id = as.factor(id)) %>% 
    dplyr::mutate(sex = factor(sex, levels = c("M", "W"))) %>%
    dplyr::mutate(treatment = factor(treatment, levels = c("pla", "for_i", "for_o", "sym", "man"))) %>%
    dplyr::group_by(id) %>% 
    dplyr::mutate(delta_tt_mpo = tt_mpo - tt_mpo[treatment == "pla"]) %>% 
    dplyr::mutate(delta_sprint_mpo = sprint_mpo - sprint_mpo[treatment == "pla"]) %>% 
    dplyr::mutate(delta_sprint_ppo = sprint_ppo - sprint_ppo[treatment == "pla"])

```

# TT MPO
```{r, echo = F}
barplot(df, "delta_tt_mpo", "Change in MPO relative to placebo (W)")
```
```{r, echo = F}
#Fit model
lm <- lmer(tt_mpo ~ treatment + (1|id), data = df, REML=FALSE)

#Show overall ANOVA output
anova(lm)

#Show estimated margingal means
emmeans(lm, specs = pairwise ~ treatment, adjust="none", pbkrtest.limit = 5000, lmerTest.limit = 5000) %>% 
    summary(infer=TRUE)

```

# Sprint PPO
```{r, echo = F}
barplot(df, "delta_sprint_ppo", "Change in sprint PPO relative to placebo (W)")
```

```{r, , echo = F}
#Fit model
lm <- lmer(sprint_ppo ~ treatment + (1|id), data = df, REML=FALSE)

#Show overall ANOVA output
anova(lm)

#Show estimated margingal means
emmeans(lm, specs = pairwise ~ treatment, adjust="none", pbkrtest.limit = 5000, lmerTest.limit = 5000) %>% 
    summary(infer=TRUE)

```

# Sprint MPO
```{r, echo = F}
barplot(df, "delta_sprint_ppo", "Change in sprint MPO relative to placebo (W)")
```

```{r, , echo = F}
#Fit model
lm <- lmer(sprint_mpo ~ treatment + (1|id), data = df, REML=FALSE)

#Show overall ANOVA output
anova(lm)

#Show estimated margingal means
emmeans(lm, specs = pairwise ~ treatment, adjust="none", pbkrtest.limit = 5000, lmerTest.limit = 5000) %>% 
    summary(infer=TRUE)

```
Correlations
```{r, echo = F}
df %>% 
    dplyr::filter(treatment == "for_i") %>% 
    ggplot(aes(x = weight, y = delta_tt_mpo))+
        geom_point(size = 4, aes(color = sex))+
    geom_hline(yintercept = 0, linetype = "dashed", linewidth = 0.25)+
    geom_smooth(method = "lm",
                se = T,
                linetype = "solid",
                linewidth = 0.75,
                aes(color = "black"))+
    ggpubr::stat_cor(aes(label = paste(..rr.label.., ..p.label.., sep = "~~~")),
                     label.x = 55,
                     label.y = 28,
                     size = 3,
                     color = "black") +
    theme(
        panel.background = element_blank(),
        panel.border = element_rect(colour = "black", fill=NA, linewidth = 0.25),
        panel.grid.minor=element_blank(),
        panel.grid.major = element_blank(),
        plot.background = element_rect(fill = "white"),
        axis.line = element_blank(),
        axis.text = element_text(color = "black"),
        #axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1),
        text = element_text(size = 8, family="Source Sans Pro", color = "black"),
        axis.title = element_text(size = 8, family="Source Sans Pro"),
        legend.title = element_blank(),
        legend.key = element_blank(),
        legend.key.size = (unit(3, "mm")),
        #legend.position = c(0.05, 0.99), 
        #legend.justification = c(0, 1), 
        #legend.box.just = "left", 
        #legend.margin = margin(0, 0, 0, 0),
        legend.background = element_blank(),
        legend.box.background = element_blank(),
        title = element_text(size = 6),
        aspect.ratio = 1,
        strip.background = element_blank()
        )+
    scale_color_manual(
            values = c(M = male_color, W = female_color),
            labels = c(M = "Male", W = "Female"))+
    labs(x = "Body weight (kg)", y = "Change in TT MPO (W)")

```
No apparent effect of relative dose.
